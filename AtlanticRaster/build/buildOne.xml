<!--
	TODO:
		- correct metamodels with errors
		- generate all/UMLDI.png (takes a lot of time)
-->
<!-- How to configure this ant script:
	Run as->Ant Build...
		Set:
			- Base directory
			- Run in same JRE
			- Refresh

			- ANTLR jar (?)
			- ant contrib jar
-->
<project name="atlanticRaster" default="transformOne">
	<!--property name="sourcePath" value="../../org.eclipse.am3.zoos.atlantic/"/>
	<property name="targetPath" value="../../org.eclipse.am3.zoos.atlanticRaster/"/>
	<property name="projectPath" value="" />

	<taskdef resource="net/sf/antcontrib/antlib.xml"/-->
	
	<!-- parameters: sample, mode -->
	<target name="transformOne" depends="loadModels">
<!--		<mkdir dir="${basedir}/${mode}"/>-->
		
		<echo message="Transforming"/>
		
		<!-- Load source model -->
		<am3.loadModel modelHandler="EMF" name="source" metamodel="KM3" path="/org.eclipse.am3.zoos.atlanticRaster/build/refiningTrace.km3">
			<injector name="ebnf">
				<param name="name" value="KM3"/>
			</injector>
		</am3.loadModel>

		<!-- Load param model -->
		<am3.loadModel modelHandler="EMF" name="param" metamodel="XML" path="/org.eclipse.am3.zoos.atlanticRaster/build/parameters/all.xml">
			<injector name="xml"/>
		</am3.loadModel>

		<!-- Transform KM3 model into DOT model -->
		<am3.atl path="/org.eclipse.am3.zoos.atlanticRaster/build/KM32DOT.asm">
			<inModel name="IN" model="source"/>
			<inModel name="KM3" model="KM3"/>
			<inModel name="Param" model="param"/>
			<inModel name="XML" model="XML"/>
			<inModel name="DOT" model="DOT"/>
			<outModel name="OUT" model="target" metamodel="DOT"/>
			<library name="XMLHelpers" path="/org.eclipse.am3.zoos.atlanticRaster/build/XMLHelpers.asm"/>
		</am3.atl>

		<!-- Serialize DOT model -->
		<am3.saveModel model="target" path="/org.eclipse.am3.zoos.atlanticRaster/build/refiningTrace.dot">
			<extractor name="atl">
				<param name="queryPath" value="/org.eclipse.am3.zoos.atlanticRaster/build/DOT2Text.atl"/>
			</extractor>
		</am3.saveModel>

	</target>

	<target name="loadModels">
		<!-- Load KM3 metamodel -->
		<am3.loadModel modelHandler="EMF" name="KM3" metamodel="MOF" nsUri="http://www.eclipse.org/gmt/2005/KM3"/>

		<!-- Load DOT metamodel -->
		<am3.loadModel modelHandler="EMF" name="DOT" metamodel="MOF" path="/org.eclipse.am3.zoos.atlanticRaster/build/DOT.ecore"/>

		<!-- Load XML metamodel -->
		<am3.loadModel modelHandler="EMF" name="XML" metamodel="MOF" path="/org.eclipse.am3.zoos.atlanticRaster/build/XML.ecore"/>
	</target>	
</project>
